---
title: "IRT without the normality assumption"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{IRT without the normality assumption}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
fontsize: 12pt
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(IRTest)
library(ggplot2)
```

\
\
\

# 1. Dichotomous items

+ **Preparing data**

The function `DataGeneration` can be used for the pre-analysis step.
This function returns a set of artificial data and some useful objects for analysis (e.g., `theta`, `data_D`, `item_D`, & `initialitem_D`).
\
\
In the parameter estimation process, 
the `initialitem_D` can be used for an input of the function `IRTest_Dich` (i.e., `initialitem = initialitem_D`).
The `data_D` is an artificial item response data that could be used for some analyses such as computer simulation techniques, but would be unnecessary if user-imported item response data is used.
The `theta` and `item_D` are not used for the estimation process, but could play a role as true parameters if the artificial data (`data_D`) is used for an analysis.

```{r}
Alldata <- DataGeneration(seed = 123456789,
                          model_D = rep(1:2, each=5),
                          N=1000,
                          nitem_D = 10,
                          nitem_P = 0,
                          latent_dist = "2NM",
                          d = 1.664,
                          sd_ratio = 2,
                          prob = 0.3)

data <- Alldata$data_D
item <- Alldata$item_D
theta <- Alldata$theta
data[1:500, 1] <- NA
data[501:1000, 2] <- NA
```

If the artificial data (`data_D`) is used, the true latent distribution looks like;

```{r, fig.align='center', fig.height=2.5, fig.width=6, echo=F}
ggplot(data = data.frame(x = c(-6,6)), aes(x)) +
  stat_function(fun = dist2, n = 101, args = list(prob = 0.3, d=1.664, sd_ratio = 2)) +
  ylab("latent density") +
  xlab(expression(theta)) +
  scale_y_continuous(breaks = NULL)
```

\
\
\

+ **Analysis** (parameter estimation)

```{r, results='hide', message=FALSE}
Mod1 <- IRTest_Dich(data = data,
                    model = 2,
                    latent_dist = "LLS",
                    h=4)
```

\
\
\

+ **Results**

```{r, fig.align='center', fig.height=6, fig.width=6}
### Summary
summary(Mod1)

### The estimated item parameters
Mod1$par_est

### The asymptotic standard errors of item parameters
Mod1$se

### The estimated ability parameters
plot(theta, Mod1$theta)
abline(b=1, a=0)
```
```{r, fig.align='center', fig.height=2.5, fig.width=6}
### The estimated latent distribution
plot(Mod1) +
  lims(y = c(0, .5))
```

+ **Item fit**
```{r}
item_fit(Mod1)
```
* Reliability

```{r}
reliability(Mod1)
```

----------

\break

# 2. Polytomous items

+ **Preparing data**

As in the case of dichotomous items, the function `DataGeneration` can be used for the pre-analysis step.
This function returns a set of artificial data and some useful objects for analysis (e.g., `theta`, `data_P`, `item_P`, & `initialitem_P`).
\
\
In the parameter estimation process, 
the `initialitem_P` can be used for an input of the function `IRTest_Poly` (i.e., `initialitem = initialitem_P`).
The `data_P` is an artificial item response data that could be used for some analyses such as computer simulation techniques, but would be unnecessary if user-imported item response data is used.
The `theta` and `item_P` are not used for the estimation process, but could play a role as true parameters if the artificial data (`data_P`) is used for an analysis.


```{r}
Alldata <- DataGeneration(seed = 123456789,
                          model_P = "GPCM",
                          categ = rep(c(3,7), each = 5),
                          N=1000,
                          nitem_D = 0,
                          nitem_P = 10,
                          latent_dist = "2NM",
                          d = 1.414,
                          sd_ratio = 2,
                          prob = 0.5)

data <- Alldata$data_P
item <- Alldata$item_P
theta <- Alldata$theta
data[1:500, 1:3] <- NA
data[501:1000, 4:6] <- NA
```

If the artificial data (`data_P`) is used, the true latent distribution looks like;

```{r, fig.align='center', fig.height=2.5, fig.width=6, echo=F}
ggplot(data = data.frame(x = c(-6,6)), aes(x)) +
  stat_function(fun = dist2, n = 101, args = list(prob = 0.5, d=1.414, sd_ratio = 2)) +
  ylab("latent density") +
  xlab(expression(theta)) +
  scale_y_continuous(breaks = NULL)
```

\
\
\

+ **Analysis** (parameter estimation)

```{r, results='hide', message=FALSE}
Mod1 <- IRTest_Poly(data = data,
                    model = "GPCM",
                    latent_dist = "KDE")
```

\
\
\

+ **Results**

```{r, fig.align='center', fig.height=6, fig.width=6}
### Summary
summary(Mod1)

### The estimated item parameters
Mod1$par_est

### The asymptotic standard errors of item parameters
Mod1$se

### The estimated ability parameters
plot(theta, Mod1$theta)
abline(b=1, a=0)
```
```{r, fig.align='center', fig.height=2.5, fig.width=6}
### The estimated latent distribution
plot(Mod1) +
  lims(y = c(0, .5))
```

+ **Item fit**
```{r}
item_fit(Mod1)
```

* Reliability

```{r}
reliability(Mod1)
```

----------

\break

# 3. Mixed-format test

+ **Preparing data**

As in the case of dichotomous and polytomous items, the function `DataGeneration` can be used for the pre-analysis step.
This function returns artificial data and some useful objects for analysis (i.e., `theta`, `data_D`, `item_D`, `initialitem_D`, `data_P`, `item_P`, & `initialitem_P`).
\
\
In the parameter estimation process, 
the `initialitem_D` and `initialitem_P` can be used for an input of the function `IRTest_Mix` (i.e., `initialitem_D = initialitem_D`, & `initialitem_P = initialitem_P`).
The `data_D` and `data_P` are artificial item response data sets that could be used for some analyses such as computer simulation techniques, but would be unnecessary if user-imported item response data is used.
The `theta` and `item_D` and `item_P` are not used for the estimation process, but could play a role as true parameters if the artificial data (`data_D` & `data_P`) is used for an analysis.


```{r}
Alldata <- DataGeneration(seed = 12345678,
                          model_D = rep(2,5),
                          model_P = "GPCM",
                          categ = rep(5,5),
                          N=1000,
                          nitem_D = 5,
                          nitem_P = 5,
                          latent_dist = "2NM",
                          d = 1.664,
                          sd_ratio = 1,
                          prob = 0.5)

DataD <- Alldata$data_D
DataP <- Alldata$data_P
itemD <- Alldata$item_D
itemP <- Alldata$item_P
theta <- Alldata$theta

DataD[1:250, 1] <- NA
DataD[251:500, 2] <- NA
DataP[501:750, 1] <- NA
DataP[751:1000, 2] <- NA
```

If the artificial data (`data`) is used, the true latent distribution looks like,

```{r, fig.align='center', fig.height=2.5, fig.width=6, echo=F}
ggplot() +
  stat_function(fun = dist2, n = 101, args = list(prob = 0.5, d=1.664, sd_ratio = 1)) +
  lims(x = c(-6,6), y = c(0, .5)) +
  ylab("latent density") +
  xlab(expression(theta)) +
  scale_y_continuous(breaks = NULL)
```

\
\
\

+ **Analysis** (parameter estimation)

```{r, results='hide', message=FALSE}
Mod1 <- IRTest_Mix(data_D = DataD,
                   data_P = DataP,
                   model_D = "2PL",
                   model_P = "GPCM",
                   latent_dist = "KDE")
```

\
\
\

+ **Results**

```{r, fig.align='center', fig.height=6, fig.width=6}
### Summary
summary(Mod1)

### The estimated item parameters
Mod1$par_est

### The asymptotic standard errors of item parameters
Mod1$se

### The estimated ability parameters
plot(theta, Mod1$theta)
abline(b=1, a=0)
```
```{r, fig.align='center', fig.height=2.5, fig.width=6}
### The estimated latent distribution
plot(Mod1) +
  lims(y = c(0, .5))
```

+ **Item fit**
```{r}
item_fit(Mod1)
```

* Reliability

```{r}
reliability(Mod1)
```

----

