---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%" 
)
library(ggplot2)
```

# IRTest

<!-- badges: start -->
[![R-CMD-check](https://github.com/SeewooLi/IRTest/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/SeewooLi/IRTest/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/IRTest)](https://CRAN.R-project.org/package=IRTest)
<!-- badges: end -->

**IRTest** can be a useful tool for IRT (item response theory) parameter estimation, especially when the violation of normality assumption on latent distribution is suspected. \
**IRTest** deals with uni-dimensional latent variable. \
In **IRTest**, along with the conventional approach that assumes normality on latent distribution, several methods can be applied for estimation of latent distribution: \
    + empirical histogram method, \
    + two-component Gaussian mixture distribution, \
    + Davidian curve, \
    + kernel density estimation.

## Installation

You can install **IRTest** on R-console with:

``` r
install.packages("IRTest")
```

## Functions

Followings are functions of **IRTest** available for users.

  + `IRTest_Dich` is the estimation function when all items are dichotomously scored.
  
  + `IRTest_Poly` is the estimation function when all items are polytomously scored.
  
  + `IRTest_Mix` is the estimation function for a mixed-format test, a combination of dichotomous item(s) and polytomous item(s).

  + `DataGeneration` generates several objects that are useful for computer simulation studies. Among these are starting values for an algorithm and artificial item-response data that can be passed to `IRTest_Dich`, `IRTest_Poly`, or `IRTest_Mix`

  + `plot_LD` draws a plot of the estimated latent distribution.
  
  + `dist2` is a probability density function of two-component Gaussian mixture distribution.
  
  + `original_par_2GM` converts re-parameterized parameters of two-component Gaussian mixture distribution into original parameters.  

## Example

A simulation study for a Rasch model can be done in following manners:

```{r library}
library(IRTest)
```

* An artificial data of 1000 examinees and 20 items.

```{r generation}
Alldata <- DataGeneration(seed = 123456789,
                          model_D = rep(1, 20),
                          N=1000,
                          nitem_D = 20,
                          nitem_P = 0,
                          d = 1.664,
                          sd_ratio = 2,
                          prob = 0.3)

data <- Alldata$data_D
item <- Alldata$item_D
initialitem <- Alldata$initialitem_D
theta <- Alldata$theta
```

* Analysis 

For an illustrative purpose, empirical histogram method is used for the estimation of latent distribution.

```{r analysis, results='hide', message=FALSE}
Mod1 <- IRTest_Dich(initialitem = initialitem,
                    data = data,
                    model = rep("1PL", 20),
                    latent_dist = "EHM",
                    threshold = .001
                    )
```

* Parameter estimation results

```{r results, fig.align='center', fig.height=6, fig.width=10}
### True item parameters 
knitr::kable(item, caption = "True item parameters")

### Estimated item parameters
knitr::kable(Mod1$par_est, caption = "Estimated item parameters")


### Plotting
par(mfrow=c(1,2))
plot(item[,2], Mod1$par_est[,2], xlab = "true", ylab = "estimated", main = "item parameters")
abline(a=0,b=1)
plot(theta, Mod1$theta, xlab = "true", ylab = "estimated", main = "ability parameters")
abline(a=0,b=1)
```

* Result of latent distribution estimation

```{r plotLD, fig.align='center', fig.height=4, fig.width=8}
plot_LD(Mod1)+
  geom_line(mapping = aes(colour="Estimated"))+
  geom_line(mapping=aes(x=seq(-6,6,length=121), 
                        y=dist2(seq(-6,6,length=121),prob = .3, d=1.664, sd_ratio = 2), 
                        colour="True"))+
  labs(title="The estimated latent density using 'EHM'", colour= "Type")+
  theme_bw()
```

* Posterior distribution for examinees

Each examinee's posterior distribution is identified in the E-step of the estimation algorithm (i.e., EM algorithm).
Posterior distributions can be found in `Mod1$Pk`.

```{r}
set.seed(1)
selected_examinees <- sample(1:1000,6)
post_sample <- data.frame(X=rep(seq(-6,6, length.out=121),6), 
                          posterior = 10*c(t(Mod1$Pk[selected_examinees,])), 
                          ID=rep(paste("examinee", selected_examinees), each=121))
ggplot(data=post_sample, mapping=aes(x=X, y=posterior, group=ID))+
  geom_line()+
  labs(title="Posterior densities for selected examinees", x=expression(theta))+
  facet_wrap(~ID, ncol=2)+
  annotate(geom="line", x=seq(-6,6,length=121), 
                        y=dist2(seq(-6,6,length=121),prob = .3, d=1.664, sd_ratio = 2), colour="grey")+
  theme_bw()
```
